{
  "openapi": "3.0.2",
  "info": {
    "title": "Search API",
    "description": "Python Microservice for Products Catalog Search API.",
    "contact": { "name": "Solfacil E-commerce Team", "email": "douglas.filho@solfacil.com.br" },
    "version": "0.1.0"
  },
  "paths": {
    "/search/kits": {
      "get": {
        "tags": ["Search"],
        "summary": "Search Kits by query terms, pagination, filtering and sorting",
        "description": "Search kits applying query term search, filters and sort\n**return**: SearchKitsOut.\n\nExample of filters:\n**?power=1.01:5.63,5.63:10.24&inverters_brand=Solis,Growatt&roof_type=cerâmica,metálico**\n\nEach filter has a comma separator on multiple values and a colon separator on each range value:\n\n**valueA,valueB**\n\n**value1:value2,value2:value3**\n\nExample of chained sorting:\n**?sort=\"power:desc|modules.amount:asc\"**\n\nSort Separator: **\"|\"**\n\nValue Sort Spec: **field_name:<asc or desc>**",
        "operationId": "search_kits_data_search_kits_get",
        "parameters": [
          {
            "required": false,
            "schema": { "title": "Page", "type": "integer", "default": 1 },
            "name": "page",
            "in": "query"
          },
          {
            "required": false,
            "schema": { "title": "Size", "type": "integer", "default": 12 },
            "name": "size",
            "in": "query"
          },
          {
            "required": false,
            "schema": { "title": "Sort", "type": "string", "default": "" },
            "name": "sort",
            "in": "query"
          },
          {
            "required": false,
            "schema": { "title": "Power", "type": "string", "default": "" },
            "name": "power",
            "in": "query"
          },
          {
            "required": false,
            "schema": { "title": "Roof Type", "type": "string", "default": "" },
            "name": "roof_type",
            "in": "query"
          },
          {
            "required": false,
            "schema": { "title": "Inverters Brand", "type": "string", "default": "" },
            "name": "inverters_brand",
            "in": "query"
          },
          {
            "required": false,
            "schema": { "title": "Query", "type": "string", "default": "" },
            "name": "query",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SearchKitsOut" } } }
          },
          "422": {
            "description": "Validation Error",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/HTTPValidationError" } } }
          }
        }
      }
    },
    "/search/indexer/reindex/kits": {
      "put": {
        "tags": ["Search Indexer"],
        "summary": "Reindex Kits Data From Source",
        "description": "Reindex Kits data from database to Search Index\n**return**: ReindexKitsOut.",
        "operationId": "reindex_kits_data_search_indexer_reindex_kits_put",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ReindexKitsOut" } } }
          }
        }
      }
    },
    "/search/indexer/index/kits": {
      "post": {
        "tags": ["Search Indexer"],
        "summary": "Index Kits",
        "description": "Index Kits\n**It is only possible to send 500 kits at a time**",
        "operationId": "index_kits_search_indexer_index_kits_post",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/IndexKitsIn" } } },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/IndexKitsOut" } } }
          },
          "422": {
            "description": "Validation Error",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/HTTPValidationError" } } }
          }
        }
      }
    },
    "/healthcheck": {
      "get": {
        "tags": ["HealthCheck"],
        "summary": "API is active?",
        "description": "Check if API is Alive\n**return**: dict.",
        "operationId": "live_healthcheck_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/GetParentServiceStatusOut" } }
            }
          }
        }
      }
    },
    "/search/kits/{sku}": {
      "get": {
        "tags": ["Search"],
        "summary": "Search Kit by sku",
        "description": "Get kit data by sku\n\n**return**: SearchKitBySkuOut.\n\nExample of filter in path parameter:\n\n**/search/kits/K118536_Sol_4995_Fib**",
        "operationId": "search_kit_search_kits__sku__get",
        "parameters": [
          { "required": true, "schema": { "title": "Sku", "type": "string" }, "name": "sku", "in": "path" }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SearchKitBySkuOut" } } }
          },
          "422": {
            "description": "Validation Error",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/HTTPValidationError" } } }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Detail": {
        "title": "Detail",
        "type": "object",
        "properties": {
          "category": { "title": "Category", "type": "string", "default": "" },
          "descriptions": { "title": "Descriptions", "type": "array", "items": { "type": "string" }, "default": [] }
        }
      },
      "Facet": {
        "title": "Facet",
        "type": "object",
        "properties": {
          "title": { "title": "Title", "type": "string", "default": "" },
          "facet_name": { "title": "Facet Name", "type": "string", "default": "" },
          "filter_name": { "title": "Filter Name", "type": "string", "default": "" },
          "options": {
            "title": "Options",
            "type": "array",
            "items": { "$ref": "#/components/schemas/FacetOption" },
            "default": []
          }
        }
      },
      "FacetOption": {
        "title": "FacetOption",
        "type": "object",
        "properties": {
          "value": { "title": "Value", "type": "string" },
          "from": { "title": "From", "type": "string" },
          "to": { "title": "To", "type": "string" },
          "count": { "title": "Count", "type": "integer", "default": 0 }
        }
      },
      "GetParentServiceStatusOut": {
        "title": "GetParentServiceStatusOut",
        "type": "object",
        "properties": {
          "status": { "allOf": [{ "$ref": "#/components/schemas/ParentServiceStatus" }], "default": "UP" },
          "is_healthy": { "title": "Is Healthy", "type": "boolean", "default": true },
          "services": {
            "title": "Services",
            "type": "array",
            "items": { "$ref": "#/components/schemas/ParentServiceStatusOut" },
            "default": []
          }
        }
      },
      "HTTPValidationError": {
        "title": "HTTPValidationError",
        "type": "object",
        "properties": {
          "detail": { "title": "Detail", "type": "array", "items": { "$ref": "#/components/schemas/ValidationError" } }
        }
      },
      "Image": {
        "title": "Image",
        "required": ["url"],
        "type": "object",
        "properties": {
          "url": { "title": "Url", "type": "string" },
          "main": { "title": "Main", "type": "boolean", "default": false }
        }
      },
      "IndexKitsIn": {
        "title": "IndexKitsIn",
        "required": ["kits"],
        "type": "object",
        "properties": { "kits": { "title": "Kits", "type": "array", "items": { "$ref": "#/components/schemas/Kit" } } }
      },
      "IndexKitsOut": {
        "title": "IndexKitsOut",
        "required": ["total_kits_indexed", "total_errors", "errors"],
        "type": "object",
        "properties": {
          "total_kits_indexed": { "title": "Total Kits Indexed", "type": "integer" },
          "total_errors": { "title": "Total Errors", "type": "integer" },
          "errors": { "title": "Errors", "type": "array", "items": {} }
        }
      },
      "Inverter": {
        "title": "Inverter",
        "required": ["sku", "power", "brand", "model", "electric_connection", "datasheet", "amount"],
        "type": "object",
        "properties": {
          "sku": { "title": "Sku", "type": "string" },
          "power": { "title": "Power", "type": "number" },
          "brand": { "title": "Brand", "type": "string" },
          "model": { "title": "Model", "type": "string" },
          "electric_connection": { "title": "Electric Connection", "type": "string" },
          "datasheet": { "title": "Datasheet", "type": "string" },
          "amount": { "title": "Amount", "type": "integer" }
        }
      },
      "Kit": {
        "title": "Kit",
        "required": [
          "sku",
          "code",
          "description",
          "seller",
          "power",
          "structure",
          "sorting_priority",
          "price",
          "discount_rate",
          "marketable",
          "inverters",
          "modules",
          "images"
        ],
        "type": "object",
        "properties": {
          "sku": { "title": "Sku", "type": "string" },
          "code": { "title": "Code", "type": "string" },
          "description": { "title": "Description", "type": "string" },
          "seller": { "$ref": "#/components/schemas/Seller" },
          "power": { "title": "Power", "type": "number" },
          "structure": { "$ref": "#/components/schemas/Structure" },
          "sorting_priority": { "title": "Sorting Priority", "type": "integer" },
          "price": { "title": "Price", "type": "number" },
          "discount_rate": { "title": "Discount Rate", "type": "number" },
          "marketable": { "title": "Marketable", "type": "boolean" },
          "inverters": { "title": "Inverters", "type": "array", "items": { "$ref": "#/components/schemas/Inverter" } },
          "modules": { "title": "Modules", "type": "array", "items": { "$ref": "#/components/schemas/Module" } },
          "images": { "title": "Images", "type": "array", "items": { "$ref": "#/components/schemas/Image" } },
          "details": { "title": "Details", "type": "array", "items": { "$ref": "#/components/schemas/Detail" } },
          "created_at": { "title": "Created At", "type": "string", "format": "date-time" },
          "updated_at": { "title": "Updated At", "type": "string", "format": "date-time" },
          "updated_by": { "title": "Updated By", "type": "string", "format": "date-time" }
        }
      },
      "MetaOut": {
        "title": "MetaOut",
        "type": "object",
        "properties": {
          "page": { "title": "Page", "type": "integer", "default": 0 },
          "size": { "title": "Size", "type": "integer", "default": 0 },
          "count": { "title": "Count", "type": "integer", "default": 0 }
        }
      },
      "Module": {
        "title": "Module",
        "required": ["sku", "brand", "model", "datasheet", "amount"],
        "type": "object",
        "properties": {
          "sku": { "title": "Sku", "type": "string" },
          "eficiency": { "title": "Eficiency", "type": "number", "default": 0 },
          "brand": { "title": "Brand", "type": "string" },
          "model": { "title": "Model", "type": "string" },
          "datasheet": { "title": "Datasheet", "type": "string" },
          "amount": { "title": "Amount", "type": "integer" }
        }
      },
      "ParentServiceStatus": {
        "title": "ParentServiceStatus",
        "enum": ["UP", "DOWN"],
        "type": "string",
        "description": "An enumeration."
      },
      "ParentServiceStatusOut": {
        "title": "ParentServiceStatusOut",
        "required": ["service_name"],
        "type": "object",
        "properties": {
          "service_name": { "title": "Service Name", "type": "string" },
          "status": { "allOf": [{ "$ref": "#/components/schemas/ParentServiceStatus" }], "default": "UP" },
          "is_healthy": { "title": "Is Healthy", "type": "boolean", "default": true }
        }
      },
      "ReindexKitsOut": {
        "title": "ReindexKitsOut",
        "required": ["indexed_kits_count"],
        "type": "object",
        "properties": { "indexed_kits_count": { "title": "Indexed Kits Count", "type": "integer" } }
      },
      "SearchKitBySkuOut": {
        "title": "SearchKitBySkuOut",
        "required": [
          "sku",
          "code",
          "description",
          "seller",
          "power",
          "structure",
          "sorting_priority",
          "price",
          "discount_rate",
          "marketable",
          "inverters",
          "modules",
          "images"
        ],
        "type": "object",
        "properties": {
          "sku": { "title": "Sku", "type": "string" },
          "code": { "title": "Code", "type": "string" },
          "description": { "title": "Description", "type": "string" },
          "seller": { "$ref": "#/components/schemas/Seller" },
          "power": { "title": "Power", "type": "number" },
          "structure": { "$ref": "#/components/schemas/Structure" },
          "sorting_priority": { "title": "Sorting Priority", "type": "integer" },
          "price": { "title": "Price", "type": "number" },
          "discount_rate": { "title": "Discount Rate", "type": "number" },
          "marketable": { "title": "Marketable", "type": "boolean" },
          "inverters": { "title": "Inverters", "type": "array", "items": { "$ref": "#/components/schemas/Inverter" } },
          "modules": { "title": "Modules", "type": "array", "items": { "$ref": "#/components/schemas/Module" } },
          "images": { "title": "Images", "type": "array", "items": { "$ref": "#/components/schemas/Image" } },
          "details": { "title": "Details", "type": "array", "items": { "$ref": "#/components/schemas/Detail" } },
          "created_at": { "title": "Created At", "type": "string", "format": "date-time" },
          "updated_at": { "title": "Updated At", "type": "string", "format": "date-time" },
          "updated_by": { "title": "Updated By", "type": "string", "format": "date-time" }
        }
      },
      "SearchKitsOut": {
        "title": "SearchKitsOut",
        "type": "object",
        "properties": {
          "meta": {
            "title": "Meta",
            "allOf": [{ "$ref": "#/components/schemas/MetaOut" }],
            "default": { "page": 0, "size": 0, "count": 0 }
          },
          "data": { "title": "Data", "type": "array", "items": { "$ref": "#/components/schemas/Kit" }, "default": [] },
          "facets": {
            "title": "Facets",
            "type": "array",
            "items": { "$ref": "#/components/schemas/Facet" },
            "default": []
          }
        }
      },
      "Seller": {
        "title": "Seller",
        "required": ["id", "name"],
        "type": "object",
        "properties": { "id": { "title": "Id", "type": "integer" }, "name": { "title": "Name", "type": "string" } }
      },
      "Structure": {
        "title": "Structure",
        "type": "object",
        "properties": {
          "installation": { "title": "Installation", "type": "string", "default": "" },
          "datasheet": { "title": "Datasheet", "type": "string", "default": "" }
        }
      },
      "ValidationError": {
        "title": "ValidationError",
        "required": ["loc", "msg", "type"],
        "type": "object",
        "properties": {
          "loc": {
            "title": "Location",
            "type": "array",
            "items": { "anyOf": [{ "type": "string" }, { "type": "integer" }] }
          },
          "msg": { "title": "Message", "type": "string" },
          "type": { "title": "Error Type", "type": "string" }
        }
      }
    }
  }
}
